{"version":3,"sources":["webpack:///./src/views/join/index.vue","webpack:///./src/views/join/index.vue?268a","webpack:///./src/assets/images/join@2x.png","webpack:///./src/views/join/index.vue?b140"],"names":["class","src","alt","title","$t","isSubHeader","registerFee","power","isActive","disabled","Number","usdtAllowance","loading","btnLoading","size","loading-text","active","approveUsdt","components","HeadTop","setup","store","t","data","address","state","accounts","web3","provider","balance","imgSrc","name","token","desc","isPreview","showDialog","UvStakeContract","UsdtContract","initContract","eth","Contract","UvStakeAbi","config","uvStakeAddress","usdtAddress","initData","getUsdtAllowance","getActiveFee","methods","decimals","call","getUserInfo","userInfo","balanceOf","usdtBalance","registerBasePower","addUserTime","getIncrease","dividedBy","toFixed","isExist","fee","allowance","result","approve","send","from","register","val","refData","render","__scopeId","module","exports"],"mappings":"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","file":"static/js/chunk-68f6d480.190ec75a.js","sourcesContent":["<template>\n  <div class=\"container\">\n    <HeadTop :title=\"$t('index.啟動礦工')\" :isSubHeader=\"true\"></HeadTop>\n    <div class=\"join\">\n      <img class=\"img\" src=\"@/assets/images/join@2x.png\" alt=\"\">\n      <div class=\"des\">{{$t('index.會員激活需要立刻支付key，支付成功後，可立即獲得power算力開啟質押挖礦',{key:registerFee+'USDT', power: power})}}</div>\n      <!-- <div class=\"des\">恭喜您激活成功，你可以參與質押挖礦了。</div> -->\n      <div class=\"btn-wrap\">\n         <van-button v-if=\"isActive\" class=\"btn\" disabled>{{$t('index.已啟動')}}</van-button>\n        <van-button v-else-if=\"Number(usdtAllowance) > 0\" class=\"btn\" :loading=\"btnLoading\" size=\"large\" :loading-text=\"$t('index.一鍵激活') + '...'\" @click=\"active\">{{$t('index.一鍵激活')}}</van-button>\n        <van-button :loading=\"btnLoading\" size=\"large\" :loading-text=\"$t('index.授權') + '...'\" v-else class=\"btn\" @click=\"approveUsdt\">{{$t('index.授權')}}</van-button>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport HeadTop from '@/components/HeadTop'\nimport { reactive, toRefs, computed, watch } from \"vue\";\nimport { useI18n } from \"vue-i18n\";\nimport { useStore } from \"vuex\";\nimport config from \"@/utils/config\";\nimport tokenAbi from \"@/utils/abi\";\nimport UvStakeAbi from \"@/utils/UvStakeAbi\";\nimport { Toast } from 'vant';\nimport { MaxUint256 } from \"@ethersproject/constants\";\nimport BigNumber from 'bignumber.js';\nexport default {\n  components: {\n    HeadTop\n  },\n  setup () {\n    const store = useStore()\n    const { t } = useI18n()\n    const data = reactive({\n      $t: t,\n      address: computed(() => store.state.accounts[0]),\n      web3: computed(() => store.state.provider),\n      balance: 0,\n      imgSrc: '',\n      name: '',\n      token: '',\n      desc: '',\n      isPreview: false,\n      showDialog: false,\n      UvStakeContract: null,\n      UsdtContract: null,\n      usdtAllowance: 0,\n      registerFee: '0',\n      btnLoading: false,\n      power: 0,\n      isActive: false,\n      initContract: () => {\n        data.UvStakeContract = new data.web3.eth.Contract(UvStakeAbi, config.uvStakeAddress)\n        data.UsdtContract = new data.web3.eth.Contract(tokenAbi, config.usdtAddress)\n        data.initData()\n      },\n      initData: () => {\n        data.getUsdtAllowance()\n        data.getActiveFee()\n      },\n      getActiveFee: async () => {\n        let decimals = await data.UsdtContract.methods.decimals().call();\n        let userInfo = await data.UvStakeContract.methods.getUserInfo(data.address).call()\n        let usdtBalance = await data.UsdtContract.methods.balanceOf(data.address).call()\n        let registerBasePower = await data.UvStakeContract.methods.registerBasePower().call()\n        let addUserTime = await data.UvStakeContract.methods.addUserTime().call()\n        let power = await data.UvStakeContract.methods.getIncrease(registerBasePower, addUserTime).call()\n        \n        if(addUserTime == 0) {\n          data.power =  new BigNumber(registerBasePower).dividedBy(10 ** 18).toFixed(3)     \n         } else {\n           data.power = new BigNumber(power).dividedBy(10 ** 18).toFixed(3)\n         }\n        // data.power = new BigNumber(power).dividedBy(10 ** 18).toFixed(3)\n        data.isActive = userInfo.isExist\n        let fee = await data.UvStakeContract.methods.registerFee().call()\n        data.registerFee = new BigNumber(fee).dividedBy(10 ** decimals).toFixed(4)\n        data.balance = new BigNumber(usdtBalance).dividedBy(10 ** decimals).toFixed(4)\n      },\n      getUsdtAllowance: async () => {\n        let result = await data.UsdtContract.methods.allowance(data.address, config.uvStakeAddress).call();\n        data.usdtAllowance = result;\n      },\n      approveUsdt: async () => {\n        data.btnLoading = true\n        try {\n           await data.UsdtContract.methods.approve(config.uvStakeAddress, MaxUint256).send({ from: data.address });\n        data.getUsdtAllowance()\n        data.btnLoading = false\n        } catch (error) {\n          data.btnLoading = false\n        }\n       \n      },\n      active: async () => {\n         if(Number(data.balance) < Number(data.registerFee)) {\n           Toast(data.$t('index.餘額不足'))\n           return\n         }\n         data.btnLoading = true\n        try {\n           await data.UvStakeContract.methods.register().send({ from: data.address });\n        data.initData()\n        Toast(data.$t('index.激活成功'))\n        data.btnLoading = false\n        } catch (error) {\n          data.btnLoading = false\n        }\n       \n      }\n    })\n    if (data.address) {\n      data.initContract()\n    }\n    watch(() => data.address, (val) => {\n      if (val) {\n        data.initContract()\n      }\n    })\n    const refData = toRefs(data);\n    return {\n      ...refData\n    };\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.container {\n  background: #fff;\n  min-height: 100vh;\n  overflow: auto;\n  padding-top: 90px !important;\n}\n.join {\n  padding: 17px 16px 16px;\n  .img {\n    width: 175px;\n    display: block;\n    margin: 0 auto;\n  }\n  .des {\n    font-size: 16px;\n    color: @deep-color;\n    word-break: break-all;\n    text-align: center;\n  }\n  .btn-wrap {\n    padding-top: 28px;\n    .btn {\n      background: @theme-color;\n      height: 48px;\n      color: #fff;\n    }\n  }\n}\n</style>\n<style lang=\"less\">\n</style>\n","import { render } from \"./index.vue?vue&type=template&id=7b582fbb&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=7b582fbb&lang=less&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7b582fbb\"\n\nexport default script","module.exports = __webpack_public_path__ + \"static/img/join@2x.0b48c69a.png\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--10-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=7b582fbb&lang=less&scoped=true\""],"sourceRoot":""}